$(document).ready(function () {

    // Convert storeOptions to AG Grid dropdown format
    const storeDropdownValues = storeOptions.map(store => store.id.toString());

    // Function to get store name from ID
    const getStoreNameById = (storeId) => {
        console.log("storeId : ",storeId)
        const store = storeOptions.find(s => s.id.toString() === storeId.toString());
        return store ? store.name : "";
    };

    // AG-Grid Column Definitions
    const columnDefs = [
        { headerName: "Item Code", field: "item_code", editable: true },
        { headerName: "Item Name", field: "item_name", editable: true },
        { headerName: "Quantity", field: "quantity", editable: true, type: 'numericColumn' },
        { headerName: "Location", field: "location", editable: true },
        { 
            headerName: "Store Name", 
            field: "store_id", 
            editable: true,
            cellEditor: 'agSelectCellEditor',
            cellEditorParams: { values: storeDropdownValues },
            valueFormatter: params => getStoreNameById(params.value) // Display store name instead of ID
        },
        { headerName: "In-Stock Date", field: "in_stock_date", editable: true, type: 'dateColumn' }
    ];

    // Grid Options
    const gridOptions = {
        columnDefs: columnDefs,
        rowData: [],
        onCellValueChanged: function(params) {
            console.log("params:", params);
            if (params.column.colId === "store_id") {
                console.log("Selected Store ID:", params.newValue, "Store Name:", getStoreNameById(params.newValue));
            }
        },
        defaultColDef: { flex: 1, editable: true }
    };

    // Initialize AG-Grid
    const gridDiv = document.querySelector("#myGrid");
    // new agGrid.Grid(gridDiv, gridOptions);

    const gridApi = agGrid.createGrid(document.querySelector("#myGrid"), gridOptions);
    console.log("agGrid : ",agGrid)
    // Add Row Button
    $('#addRow').on('click', function () {
        gridApi.applyTransaction({ add: [{
            item_code:'A30345',
            item_name:'Tshirt',
            quantity:100,
            location:'Surat',
            store_id:1,
            in_stock_date:'2025-03-15',
        }] });
        
    });
    // console.log("call",gridOptions.api.applyTransaction);
    // gridOptions.api.applyTransaction({ add: [{}] });

    // Submit Data Button
    $('#submitData').on('click', function () {
        let rowData = [];
        console.log(gridApi)
        gridApi.forEachNode(node => rowData.push(node.data));
        console.log(rowData)

        postAuthRequest('/user/stock/add',{entries:rowData},function(res,err){
            Toast(res.msg,res.flag)
            if(res.flag){
                setTimeout(() => {
                    window.location.href = BASE_URL + '/user/dashboard';
                }, 1000);
            }
        })
    });

});